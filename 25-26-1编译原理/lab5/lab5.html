<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>逆波兰式转换与计算器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.secondary {
            background-color: #95a5a6;
        }
        
        button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }
        
        .result-box h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .result-content {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            min-height: 60px;
            border: 1px solid #eaeaea;
            font-family: monospace;
            font-size: 16px;
            word-break: break-all;
        }
        
        .error {
            color: #e74c3c;
            margin-top: 10px;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 5px;
            display: none;
        }
        
        .success {
            color: #27ae60;
            margin-top: 10px;
            padding: 10px;
            background-color: #d5f4e6;
            border-radius: 5px;
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .results {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>逆波兰式的生成及计算程序</h1>
            <p class="subtitle">中缀表达式转后缀表达式并计算结果</p>
        </header>
        
        <div class="input-section">
            <div class="input-group">
                <label for="infix-expression">中缀表达式</label>
                <input type="text" id="infix-expression" placeholder="例如: 28+68*2 或 (28+68)*2">
            </div>
            
            <div class="buttons">
                <button id="convert-btn">转换为后缀表达式</button>
                <button id="calculate-btn" class="secondary">计算</button>
                <button id="clear-btn" class="secondary">清空</button>
            </div>
            
            <div id="error-message" class="error"></div>
            <div id="success-message" class="success"></div>
        </div>
        
        <div class="results">
            <div class="result-box">
                <h3>后缀表达式</h3>
                <div id="postfix-result" class="result-content">等待输入...</div>
            </div>
            
            <div class="result-box">
                <h3>计算结果</h3>
                <div id="calculation-result" class="result-content">等待计算...</div>
            </div>
        </div>
        
        <footer>
            <p>编制人：方泽宇；学号：2351610105；班级：23508014</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const infixInput = document.getElementById('infix-expression');
            const convertBtn = document.getElementById('convert-btn');
            const calculateBtn = document.getElementById('calculate-btn');
            const clearBtn = document.getElementById('clear-btn');
            const postfixResult = document.getElementById('postfix-result');
            const calculationResult = document.getElementById('calculation-result');
            const errorMessage = document.getElementById('error-message');
            const successMessage = document.getElementById('success-message');
            
            // 运算符优先级
            const priority = {
                '#': 0,
                '(': 1,
                '+': 2, 
                '-': 2,
                '*': 3, 
                '/': 3,
                ')': 4
            };
            
            // 检查字符是否为运算符
            function isOperator(c) {
                return c === '+' || c === '-' || c === '*' || c === '/' || c === '(' || c === ')' || c === '#';
            }
            
            // 比较运算符优先级
            function higherPriority(op1, op2) {
                return priority[op1] > priority[op2];
            }
            
            // 中缀表达式转逆波兰式
            function infixToPostfix(infix) {
                const opStack = [];
                let postfix = '';
                let numberBuffer = '';
                
                // 在表达式末尾添加#
                const expression = infix + '#';
                
                for (let i = 0; i < expression.length; i++) {
                    const c = expression[i];
                    
                    if (/\d/.test(c)) {
                        // 处理数字
                        numberBuffer += c;
                    } else {
                        // 数字缓冲区非空，输出数字
                        if (numberBuffer.length > 0) {
                            if (postfix.length > 0 && /\d/.test(postfix[postfix.length - 1])) {
                                postfix += '&'; // 数字分隔符
                            }
                            postfix += numberBuffer;
                            numberBuffer = '';
                        }
                        
                        if (isOperator(c)) {
                            if (c === '(') {
                                opStack.push(c);
                            } else if (c === ')') {
                                // 弹出直到遇到左括号
                                while (opStack.length > 0 && opStack[opStack.length - 1] !== '(') {
                                    postfix += opStack.pop();
                                }
                                if (opStack.length > 0 && opStack[opStack.length - 1] === '(') {
                                    opStack.pop(); // 弹出左括号
                                }
                            } else if (c === '#') {
                                // 弹出所有运算符
                                while (opStack.length > 0) {
                                    postfix += opStack.pop();
                                }
                            } else {
                                // 普通运算符
                                while (opStack.length > 0 && opStack[opStack.length - 1] !== '(' && 
                                       !higherPriority(c, opStack[opStack.length - 1])) {
                                    postfix += opStack.pop();
                                }
                                opStack.push(c);
                            }
                        }
                    }
                }
                
                return postfix;
            }
            
            // 计算逆波兰式
            function calculatePostfix(postfix) {
                const numStack = [];
                let numberBuffer = '';
                
                for (let i = 0; i < postfix.length; i++) {
                    const c = postfix[i];
                    
                    if (/\d/.test(c)) {
                        // 处理数字
                        numberBuffer += c;
                    } else if (c === '&') {
                        // 数字分隔符，将缓冲区数字入栈
                        if (numberBuffer.length > 0) {
                            numStack.push(parseFloat(numberBuffer));
                            numberBuffer = '';
                        }
                    } else if (isOperator(c) && c !== '(' && c !== ')' && c !== '#') {
                        // 处理运算符
                        if (numberBuffer.length > 0) {
                            numStack.push(parseFloat(numberBuffer));
                            numberBuffer = '';
                        }
                        
                        if (numStack.length < 2) {
                            throw new Error("表达式错误：运算对象不足");
                        }
                        
                        const b = numStack.pop();
                        const a = numStack.pop();
                        let result;
                        
                        switch (c) {
                            case '+': result = a + b; break;
                            case '-': result = a - b; break;
                            case '*': result = a * b; break;
                            case '/': 
                                if (b === 0) throw new Error("数学错误：除零错误");
                                result = a / b; 
                                break;
                            default: throw new Error("未知运算符");
                        }
                        
                        numStack.push(result);
                    }
                }
                
                // 处理最后一个数字
                if (numberBuffer.length > 0) {
                    numStack.push(parseFloat(numberBuffer));
                }
                
                if (numStack.length !== 1) {
                    throw new Error("表达式错误：结果不唯一");
                }
                
                return numStack[0];
            }
            
            // 验证中缀表达式
            function validateInfix(infix) {
                const parenStack = [];
                let lastWasOperator = true; // 开始时期望数字或左括号
                
                for (let i = 0; i < infix.length; i++) {
                    const c = infix[i];
                    
                    if (/\d/.test(c)) {
                        lastWasOperator = false;
                    } else if (c === '(') {
                        parenStack.push(c);
                        lastWasOperator = true;
                    } else if (c === ')') {
                        if (parenStack.length === 0 || parenStack[parenStack.length - 1] !== '(') {
                            return false; // 括号不匹配
                        }
                        parenStack.pop();
                        lastWasOperator = false;
                    } else if (isOperator(c) && c !== '#' && c !== '(' && c !== ')') {
                        if (lastWasOperator) {
                            return false; // 连续运算符
                        }
                        lastWasOperator = true;
                    } else if (!/\d/.test(c) && !isOperator(c)) {
                        return false; // 非法字符
                    }
                }
                
                return parenStack.length === 0 && !lastWasOperator;
            }
            
            // 显示错误消息
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
            
            // 显示成功消息
            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            }
            
            // 隐藏所有消息
            function hideMessages() {
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
            }
            
            // 转换按钮点击事件
            convertBtn.addEventListener('click', function() {
                hideMessages();
                const infix = infixInput.value.trim();
                
                if (!infix) {
                    showError('请输入中缀表达式');
                    return;
                }
                
                try {
                    if (!validateInfix(infix)) {
                        showError('表达式格式错误');
                        return;
                    }
                    
                    const postfix = infixToPostfix(infix);
                    postfixResult.textContent = postfix;
                    showSuccess('转换成功');
                } catch (error) {
                    showError('转换错误: ' + error.message);
                }
            });
            
            // 计算按钮点击事件
            calculateBtn.addEventListener('click', function() {
                hideMessages();
                const infix = infixInput.value.trim();
                
                if (!infix) {
                    showError('请输入中缀表达式');
                    return;
                }
                
                try {
                    if (!validateInfix(infix)) {
                        showError('表达式格式错误');
                        return;
                    }
                    
                    const postfix = infixToPostfix(infix);
                    const result = calculatePostfix(postfix);
                    
                    postfixResult.textContent = postfix;
                    calculationResult.textContent = result;
                    showSuccess('计算成功');
                } catch (error) {
                    showError('计算错误: ' + error.message);
                }
            });
            
            // 清空按钮点击事件
            clearBtn.addEventListener('click', function() {
                infixInput.value = '';
                postfixResult.textContent = '等待输入...';
                calculationResult.textContent = '等待计算...';
                hideMessages();
            });
            
            // 示例表达式
            infixInput.value = '28+68*2';
        });
    </script>
</body>
</html>