# Spring MVC 和 MyBatis 核心框架整理

* By：2351610105方泽宇，generated by ChatGPT-5.1
## Spring MVC 核心配置

### 1. web.xml 配置
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app>
    <!-- 配置Spring MVC前端控制器 -->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springmvc.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
</web-app>
```

### 2. springmvc.xml 配置
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans>
    <!-- 扫描控制器 -->
    <context:component-scan base-package="com.example.controller"/>
    
    <!-- 开启注解驱动 -->
    <mvc:annotation-driven/>
    
    <!-- 视图解析器 -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/views/"/>
        <property name="suffix" value=".jsp"/>
    </bean>
</beans>
```

### 3. Controller 示例
```java
package com.example.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
@RequestMapping("/user")
public class UserController {
    
    // 显示添加表单
    @GetMapping("/add")
    public String showAddForm(Model model) {
        model.addAttribute("user", new User());
        return "user/add";
    }
    
    // 处理添加请求
    @PostMapping("/add")
    public String addUser(@ModelAttribute User user) {
        // 调用Service处理业务
        return "redirect:/user/list";
    }
    
    // 显示用户列表
    @GetMapping("/list")
    public String listUsers(Model model) {
        // 获取用户列表
        return "user/list";
    }
}
```

### 4. JSP 页面示例
```jsp
<!-- add.jsp -->
<form action="add" method="post">
    <input type="text" name="username"/>
    <input type="password" name="password"/>
    <input type="submit" value="提交"/>
</form>

<!-- list.jsp -->
<c:forEach items="${userList}" var="user">
    <tr>
        <td>${user.id}</td>
        <td>${user.username}</td>
    </tr>
</c:forEach>
```

## MyBatis 核心配置

### 1. mybatis-config.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration>
<configuration>
    <!-- 数据库连接配置 -->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/test"/>
                <property name="username" value="root"/>
                <property name="password" value="123456"/>
            </dataSource>
        </environment>
    </environments>
    
    <!-- 映射文件 -->
    <mappers>
        <mapper resource="com/example/mapper/UserMapper.xml"/>
    </mappers>
</configuration>
```

### 2. Mapper 接口
```java
package com.example.mapper;

import org.apache.ibatis.annotations.*;
import java.util.List;

public interface UserMapper {
    // 插入用户
    @Insert("INSERT INTO users(username, password) VALUES(#{username}, #{password})")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insertUser(User user);
    
    // 查询所有用户
    @Select("SELECT * FROM users")
    List<User> selectAllUsers();
    
    // 根据ID查询
    @Select("SELECT * FROM users WHERE id = #{id}")
    User selectUserById(Integer id);
    
    // 更新用户
    @Update("UPDATE users SET username=#{username} WHERE id=#{id}")
    int updateUser(User user);
    
    // 删除用户
    @Delete("DELETE FROM users WHERE id = #{id}")
    int deleteUser(Integer id);
}
```

### 3. XML 映射文件
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper>
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- 结果映射 -->
    <resultMap id="userMap" type="User">
        <id property="id" column="id"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="email" column="email"/>
    </resultMap>
    
    <!-- 条件查询 -->
    <select id="selectByCondition" parameterType="map" resultMap="userMap">
        SELECT * FROM users 
        WHERE 1=1
        <if test="username != null">
            AND username LIKE CONCAT('%', #{username}, '%')
        </if>
        <if test="email != null">
            AND email = #{email}
        </if>
    </select>
    
    <!-- 分页查询 -->
    <select id="selectByPage" parameterType="map" resultMap="userMap">
        SELECT * FROM users 
        LIMIT #{offset}, #{pageSize}
    </select>
</mapper>
```

### 4. Service 层
```java
package com.example.service;

import org.springframework.stereotype.Service;
import javax.annotation.Resource;

@Service
public class UserService {
    @Resource
    private UserMapper userMapper;
    
    public boolean addUser(User user) {
        return userMapper.insertUser(user) > 0;
    }
    
    public List<User> getAllUsers() {
        return userMapper.selectAllUsers();
    }
    
    public User getUserById(Integer id) {
        return userMapper.selectUserById(id);
    }
}
```

## Spring 整合 MyBatis

### 1. applicationContext.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans>
    <!-- 数据源 -->
    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost:3306/test"/>
        <property name="username" value="root"/>
        <property name="password" value="123456"/>
    </bean>
    
    <!-- SqlSessionFactory -->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="mapperLocations" value="classpath:com/example/mapper/*.xml"/>
    </bean>
    
    <!-- Mapper扫描 -->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.example.mapper"/>
    </bean>
    
    <!-- 事务管理 -->
    <bean id="transactionManager" 
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
</beans>
```

## 核心要点总结

### Spring MVC：
1. **DispatcherServlet**：前端控制器
2. **@Controller**：标识控制器类
3. **@RequestMapping**：映射请求路径
4. **@GetMapping/@PostMapping**：指定请求方法
5. **@RequestParam**：获取请求参数
6. **@PathVariable**：获取URL路径参数
7. **@ModelAttribute**：绑定表单数据
8. **Model**：向视图传递数据

### MyBatis：
1. **SqlSessionFactory**：核心工厂类
2. **Mapper接口**：数据访问接口
3. **@Select/@Insert/@Update/@Delete**：SQL注解
4. **#{}**：参数占位符（防SQL注入）
5. **resultMap**：结果集映射
6. **动态SQL**：if、choose、foreach等标签

### 整合关键：
1. **SqlSessionFactoryBean**：Spring管理的SqlSessionFactory
2. **MapperScannerConfigurer**：自动扫描Mapper接口
3. **@Transactional**：声明式事务管理

## 快速记忆口诀

```
Spring MVC三要素：
DispatcherServlet前端控，
Controller类注解标，
@RequestMapping路径找。

MyBatis四操作：
@Select查，@Insert增，
@Update改，@Delete删，
#{}参数安全传。

整合要点记心间：
数据源、工厂Bean，
Mapper扫描自动连，
事务注解业务面。
```