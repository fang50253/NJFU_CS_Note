<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>图片上色</title>
</head>
<body>
<input type="file" class="fileup">
<button class="color">执行黑白图片上色</button>
<button class="anime">执行任务动漫化</button>
<div>
  <h3>原始图片</h3>
  <img id="original" width="300">
</div>
<div>
  <h3>完成图片</h3>
  <img id="colored" width="300">
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
  $('.color').click(function(){
    const file = $('.fileup')[0].files[0];
    if (!file) {
      alert("请先选择文件");
      return;
    }

    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = function(){
      const base64 = reader.result;
      $('#original').attr('src', base64);


      $.ajax({
        type: "POST",
        url: "http://127.0.0.1:3000/black",
        contentType: "application/json",
        data: JSON.stringify({ file: base64.replace(/^data:image\/\w+;base64,/, "") }),
        success: function(data){
          $('#colored').attr('src', 'data:image/jpeg;base64,' + data.image);
        },
        error: function(){
          alert("上传失败");
        }
      });
    }
  });
  $('.anime').click(function(){
    const file = $('.fileup')[0].files[0];
    if (!file) {
      alert("请先选择文件");
      return;
    }

    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = function(){
      const base64 = reader.result;
      $('#original').attr('src', base64);


      $.ajax({
        type: "POST",
        url: "http://127.0.0.1:3000/anime",
        contentType: "application/json",
        data: JSON.stringify({ file: base64.replace(/^data:image\/\w+;base64,/, "") }),
        success: function(data){
          $('#colored').attr('src', 'data:image/jpeg;base64,' + data.image);
        },
        error: function(){
          alert("上传失败");
        }
      });
    }
  });
</script>
</body>
</html>