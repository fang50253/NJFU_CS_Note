<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<input type="file" id="imgid">
<img src="" id="img" width="200px">
<button>图像识别</button>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $(function () {
        let base64 = "";

        $('#imgid').change(function () {
            const file = this.files[0];
            if (!file) return;

            // 验证图片大小（不超过4MB）
            if (file.size > 4 * 1024 * 1024) {
                alert('图片大小不能超过4MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                $('#img').attr('src', e.target.result);
                base64 = e.target.result;
                console.log('图片已加载，大小:', Math.round(base64.length/1024) + 'KB');
            };
            reader.readAsDataURL(file);
        });

        $('button').click(function() {
            if (!base64) {
                alert('请先选择图片');
                return;
            }

            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:3000/checkImg",
                contentType: "application/json",
                data: JSON.stringify({ img1: base64 }),
                success: (data) => {
                    console.log('识别结果:', data);
                    if (data.length > 0) {
                        alert(`识别结果: ${data[0].keyword}\n置信度: ${data[0].score}`);
                    } else {
                        alert('未识别到有效内容');
                    }
                },
                error: (xhr) => {
                    const error = xhr.responseJSON || { error: '请求失败' };
                    alert(`错误: ${error.error}\n${error.detail || ''}`);
                }
            });
        });
    });
</script>
</body>
</html>