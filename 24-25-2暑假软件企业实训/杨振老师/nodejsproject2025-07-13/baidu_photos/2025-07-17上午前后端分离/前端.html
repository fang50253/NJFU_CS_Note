<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<input type="file" id="imgid">
<img src="" id="img" width="200px">
<button>图像识别</button>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $(function () {
        var base64 = ""; // 定义全局变量存储 base64
        var fpath="";
        $('#imgid').change(function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#img').attr('src', e.target.result);
                console.log(e.target.result);
                console.log("文件类型:", file.type);
                console.log(fpath);
                base64 = e.target.result; // 更新全局变量
            };
            reader.readAsDataURL(file);
        });

        $('button').click(function() {
            // 从 base64 中移除前缀（如 data:image/jpeg;base64,）
            var pureBase64 = base64.split(',')[1] || base64;

            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:3000/checkImg",
                contentType: "application/x-www-form-urlencoded", // 重要
                data: {
                    "img1": pureBase64
                },
                success: function(data) {
                    alert(JSON.stringify(data));
                },
                error: function(xhr, status, error) {
                    alert("Error: " + error);
                }
            });
        });
    });
</script>
</body>
</html>