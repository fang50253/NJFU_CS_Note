# 南京林业大学淮安校区直播方案完全指南

## 〇.写在开始

1. 这篇指南是采用2022级机械设计制造及其自动化、第十届、第十一届招生办公室助理团陈新言同学的文档，并对文档部分内容进行扩写的文档。

2. 本文档版权由南京林业大学招生办公室助理团所有，原则上本文档属于招生办公室淮安新媒体部内部文件，如有其他部门获得此文档，请立即删除，或者在时任招生办公室淮安新媒体部部长同意之后进行阅读。

3. 鉴于2025年7月之后本文原作者已离开淮安校区，本文的相关维护工作由招生办公室淮安新媒体继续负责。如果有相关问题您也可以联系本文原作者`QQ:1139950253`、`Mail:fzy1139950253@gmail.com`。本人不代表第十一届、第十二届招生办公室助理团，自愿放弃本文和在招生办公室助理团淮安新媒体部工作期间一切作品的版权，任何自然人可以以盈利或非盈利为目的复制、发行、展览、信息网络传播、改编、翻译、汇编，对于部门或组织的使用，请联时任招生办公室助理团淮安新媒体部部长授权。

## 一.直播的原理

1. 通过SRS软件建立直播用服务器，再通过OBS Studio切换画面，推回SRS服务器。

2. 对于操场上的直播，由于操场主席台的计算机无法连接互联网，但是与学校其他区域(如宿舍。除教学楼4号楼、行政楼)的的网络想连接，所以需要通过学校其他区域的网络进行二次转发。

3. 对于教学主楼A报告厅内的直播，由于能够直接连接上互联网，因此可以直接使用OBS Studio进行输出。

## 二.直播的准备

### 一般性准备

1. 相机一台(建议关闭自动对焦，使用手动对焦MF将焦点固定在舞台上)

2. 假电池一块(原则上需要使用假电池以延长相机持续的录制时间，但是经过实测唯卓仕的fz100电池可以通过micro-USB接口的持续供电实现假电池的功能。因此推荐索尼α1,α7III,α7IV,α7RIII,α7RⅣ,α7RV,α9,α9II,α9III,α6600,α6700,α7SIII,FX3等机型用户使用唯卓仕电池)

3. 笔记本电脑不少于1台(原则上建议使用单显卡的笔记本电脑，但是如果是具有独显直连，或者通过省电模式可以关闭独立显卡的笔记本电脑也可以使用)。推荐使用单显卡的全能本、MacBook。

```
如有不少于一台笔记本电脑，请阅读以下指南：

1. 用于直播画面切换/在宿舍进行直播画面转发的笔记本电脑必须是单显卡/支持显卡直连/支持关闭独立显卡的。

2. 安装SRS的笔记本电脑应当拥有千兆或万兆网口提供足够网速，并拥有较强的CPU性能。
```

4. 三脚架(越高越好，2024年末迎新晚会使用了一个2.2米高度的三脚架)

5. 路由器一台(校区有一台小米AX3000T路由器，如有需要请联系时任招生办公室助理团淮安新媒体部部长借用)

6. 如在操场直播，请准备足够长的插线板，足够长的网线(校区有一根30米的绿联CAT-5e网线、2根20米的插线板，如有需要请联系时任招生办公室助理团淮安新媒体部部长借用)

### 特殊性准备

1. 如使用APS-C画幅的微单相机，建议提前一天进行持续性压力测试，防止机身过热关机的情况发生。可以通过购买退热贴、散热背夹等方式演唱录制时间。一般情况下，如果您采用USB接口进行视频输出，即使是索尼α6700也不会存在过热的问题，如果您采用采集卡进行输出，务必提前进行压力测试。

2. 鉴于通过USB接口输出的画面质量普遍较低，对于有HDMI/micro-USB接口的相机，可以通过采集卡和HDMI线连接笔记本电脑，并在相机机内进行相关设置，使其输出全尺寸4K画面。

3. DJI OSMO Pocket3、DJI Mavic Air3等实现多机位直播。

4. DJI Mic (第二代) 用于获取更高质量的音频。在2024年10月的迎新晚会直播活动中，DJI Mic (第二代)存在一定的信号问题，舞台到直播机位之间距离较长，出现了信号断联的故障。

5. 如果需要将直播的画面推送至多个平台，请安装兼容OBS的多路推流插件。

### 直播前你应该做的

0. (可选操作)安装ffmpeg：下载并解压ffmpeg，将ffmpeg的bin目录添加至系统环境变量。

windows11系统的操作：右击“此电脑”->属性->高级系统设置->环境变量->系统变量/Path->新建，之后一路保存即可。

macOS系统的操作(以macOS14.6.1为例)，打开终端，输入`nano ~/.zshrc`，将`export PATH="$PATH:bin目录路径"`添加，按下cmd+s，终端中输入`source ~/.zshrc`，即配置完成。(如果您使用的是bash终端，您只需要将上述内容中所有的`.zshrc`替换为`.bash_profile`即可)。

1. 安装SRS客户端。

`https://ossrs.net/lts/zh-cn/`

2. 安装OBS Studio客户端，可以通过官方网站下载最新版本，也可以通过Steam客户端进行下载。

`https://obsproject.com/`

3. 安装ffmpeg，供调试时使用。

`https://ffmpeg.org/`

4. 与老师协商直播方案，获取校区领导的许可。

5. 硬件上的准备

操场上，请将网线的一段插在操场看台下方中间最靠南侧的教室的这台交换机上

![pic15](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic15.png?raw=true)

## 三.直播的配置

1. 使用管理员权限打开 SRS 客户端,在接下来的操作过程中，保持SRS客户端在后台运行即可，请不要关闭SRS客户端(安装SRS的笔记本电脑应当拥有千兆或万兆网口提供足够网速，并拥有较强的CPU性能。如果在操场上直播，这台电脑建议放置在操场上。一般情况下建议使用Windows系统)

![srs_software](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic3.png?raw=true)

2. 接下来我们对路由器进行设置。登陆SRS电脑所连接的路由器后台管理页面，小米路由器的登录地址默认为`192.168.31.1`，其他路由器请查看路由器背后的贴纸，或者是网上查阅相关资料。这里我们是使用刷入OpenWRT操作系统的小米路由器演示的，和一般的小米路由器系统不一致，但是原理上是相似的。

3. 我们首先记住这台路由器的ip地址，这对我们来说很重要。

![ip](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic4.png?raw=true)

4. 大概这台电脑的命令提示符，对于Windows系统，我们同时按住Windows徽标键+R，输入cmd回车，在看到的cmd命令提示框内输入命令`ipconfig`，之后你会看到如下图所示的内容。找到“ipv4地址”，查看ipv4地址，这个ip地址的前3位与路由器的登录地址相同，即对于小米路由器，一般情况下为`192.168.31.*`。

![ipconfig](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic5.png?raw=true)

5. 进入路由器设置的高级设置/防火墙，进入端口转发，创建一条规则，将安装SRS软件的电脑的ip地址作为内网IP进行映射，如果没有特殊需求一般情况下建议直接开启DMZ(转发全部端口)。其他设置默认即可。

![dmz](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic6.png?raw=true)

6. 下面我们对直播的机位进行编号，建议将编号提前写在一张纸上，并贴在安装OBS切换输出的笔记本电脑前。例如2024年迎新晚会直播中我们使用了如下设备：

```
1. ILCE-6700   编号：01
2. DJI Mavic Air3   编号：02
3. DJI Mavic Air2   编号：03
4. DJI Osmo Pocket3   编号：04
5. Canon Eos R8   编号：05
```
另外我们需要对一些其他画面再次编号：

```
6. 直播画面输出   编号：00
7. 音频输入信号(如有必要)   编号：06
```

7. 下面我们来设置在校区其他地方(一般建议在非12栋以外的宿舍楼，网口改为8线全通的宿舍)，专门用于转发至外网的笔记本电脑，这台笔记本电脑原则上要求单显卡，具体原因见常见问题。

创建一个新的场景，并新建一个媒体源

![new1](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic7.jpg?raw=true)

![new2](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic8.jpg?raw=true)

取消勾选本地文件，在“输入”中填写ip地址：格式为：`rtmp://室外路由器ip地址/livestream/直播画面输出的机位号`

(下面的配图出现了错误，应该是`rtmp://10.58.3.161/livestream/*`)

![new3](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic9.png?raw=true)

回到OBS主页面，点击“转场动画”即可看到输出画面，如果未见输出画面，请移步本文末尾“常见问题2”。之后我们点击“设置”。

![new4](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic10.png?raw=true)

点击直播，将从网站获取到的直播推送网站和密钥输入这边，回到主界面，点击“开始直播”和“开始录制”

![new5](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic11.png?raw=true)

8. 下面我们来设置外场的，用于切换画面的笔记本电脑。(可以和SRS电脑为同一台电脑，也可以不是同一台，受限于性能原因，建议使用2台以上的笔记本电脑)

接下来你输入的ip地址永远都是`192.168.31.*`(如果您使用的是小米路由器)，通常是作为SRS服务器的笔记本电脑。且接下来的操作，无需使用10.*.*.*开头的路由器IP地址。

为每一个机位创建一个场景，使用USB线或采集卡将相机连接笔记本电脑，并通过“视频采集设备”创建视频源。类似于前一条中的拉流操作，对于大疆的设备，可以在DJI Go 4、DJI Fly、DJI Mimo等软件中的直播选项输入推流地址，通过“媒体源”进行拉流。

切换画面的操作，点击“转场动画”即可。

![trans](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic12.png?raw=true)

在同一个场景中，处在上方的输入会覆盖掉下面的输入，所以如果您想添加多个画面混合的视频，请将在上方的图层移动至上方。

如果您使用了其他的音频采集设备，或者避免在切换画面时切换音频，请在右侧的混音器中修改声音的输入来源。

建议：在一场直播中尽可能采用唯一的声音来源，声音不随着画面切换而切换。通常是建议使用DJI Mic (第二代)等高质量的音频作为收音设备，或者使用相机作为声音来源。

和上面类似的，点击“设置”，点击直播，将从网站获取到的直播推送网站和密钥输入这边，回到主界面，点击“开始直播”和“开始录制”。你也可以在设置的“输出”中，在直播输出中修改视频的码率。

对于切换画面，您只需要点击“转场动画”，或者拖动快速转场下面的滑轨即可。

*通常1080P需要在码率不低于20M(20000K)获得较为可用的画质，但是往往直播无法承受如此大的带宽，因此我们可以先设置一个较高值(通常不高于10000K)，如果出现显著的卡顿再进行调整。直播开始后请尽量不要操作码率选项，2024年10月迎新晚会最后推送的码率为4M，即4000K，轻度卡顿。如果您仍想获得一个相对可用的画质，建议您在直播机位的边上另行放置一台相机进行全程录像。对于DJI设备，选择较高的码率一般不会出现严重的卡顿。

9. 直播录像的转码

通过OBS Studio录制的直播回放往往是mkv格式，转码的方法为：

```bash
ffmpeg -i 输入.mkv -c copy 输出.mp4
```

## 四.常见问题

1. 如果老师要求设置延迟推送，并在出现问题时及时切断直播画面，我应该如何操作？

答：这种情况下建议至少使用2台笔记本电脑，将直播输出的画面推送至SRS服务器后，通过第二台笔记本电脑拉取视频，并在设置、高级、直播延迟中设置直播延迟。如果出现突发问题，请在延迟时间内登陆微信视频号平台等平台关闭直播推流，然后再关闭其他设备。

![SRS_Video](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic1.png?raw=true)

2. 如果一切配置完毕，但是OBS Studio拉取不到视频画面，应该如何处理？

答：这种情况往往是因为这台笔记本电脑拥有2张显卡导致的，理论上采用单显卡的笔记本电脑可以避免此类情况。排查方法是通过系统的终端/cmd，输入ffmpeg命令，语法格式为：`ffplay rtmp://*/livestream/*`，如果ffmpeg可以正常读取，则可能是双显卡输出导致的兼容性Bug。

临时的解决方案：使用ffmpeg将视频全屏播放，采用屏幕采集获取视频。

![ffmpeg](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic14.png?raw=true)

![can_not_read_video](https://github.com/fang50253/NJFU_CS_Note/blob/main/Others/pic/live/pic2.png?raw=true)

解决方案：开启显卡直连、关闭独立显卡、更换电脑。

## 五.写在最后

1. 或许你也发现了，这篇文章的作者是一位不受人待见的学长。相比于前一篇更加精简的直播方案的作者来说，我是从各方面都不如的，不论是性格还是能力......我确实是一个性格不那么完善，不那么受人欢迎的学长，奈何2025年淮安社团巡礼节没有直播，作者担心这项内容难以传承，故撰写。虽然因为周围某学校的直播事故，以后再也不会用到，但，以备不时之需。如果我有做什么让你们不舒服的事，一定要直接和我说，我知道我只有多接受批评才能改进我的性格。

2. 祝活动顺利。

3. 第一版2024-10-12

4. 第二版2025-04-17